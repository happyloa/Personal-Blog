---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("posts", ({ data }) => !data.draft);
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const formattedDate = post.data.date
  ? new Date(post.data.date).toLocaleDateString("zh-TW", {
      year: "numeric",
      month: "short",
      day: "numeric",
    })
  : "未設定日期";
const isoDate = post.data.date ? new Date(post.data.date).toISOString() : "";
---

<BaseLayout
  title={`${post.data.title} | Aaron 的部落格`}
  description={post.data.description ?? post.data.title}>
  <article class="prose prose-lg">
    {
      post.data.date ? (
        <time datetime={isoDate} class="text-sm text-slate-300">
          {formattedDate}
        </time>
      ) : (
        <p class="text-sm text-slate-300">{formattedDate}</p>
      )
    }
    <h1 class="text-3xl font-bold mt-2 mb-4">{post.data.title}</h1>
    {
      post.data.tags.length ? (
        <div class="flex flex-wrap gap-2 mb-6">
          {post.data.tags.map((tag) => (
            <a
              class="tag-pill no-underline"
              href={`/tags/${tag}/`}
              aria-label={`查看 #${tag} 標籤文章`}>
              #{tag}
            </a>
          ))}
        </div>
      ) : null
    }
    <div class="prose">
      <Content />
    </div>
  </article>
</BaseLayout>
